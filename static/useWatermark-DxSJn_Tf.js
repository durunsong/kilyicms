import{m as C}from"./index-n9fM5Zhe.js";import{k as u}from"./element-BaWQJB8U.js";import{r as L,X as R}from"./vue-CDBYdBif.js";const{t:E}=C.global,W={defense:!0,color:"#c0c4cc",opacity:.5,size:16,family:"serif",angle:-20,width:300,height:200},O=L(document.body);function B(s=O){let d,v,t=null;const r={watermarkElMutationObserver:void 0,parentElMutationObserver:void 0,parentElResizeObserver:void 0},k=(e,a={})=>{if(!s.value){console.warn(E("warning_set_watermark_after_dom_mount",{dom:"DOM",method:"setWatermark"}));return}d=e,v={...W,...a},t?m():h(),f(s.value)},h=()=>{const e=s.value.tagName.toLowerCase()===O.value.tagName.toLowerCase(),a=e?"fixed":"absolute",o=e?"":"relative";t=document.createElement("div"),t.style.pointerEvents="none",t.style.top="0",t.style.left="0",t.style.position=a,t.style.zIndex="99999";const{clientWidth:i,clientHeight:l}=s.value;m({width:i,height:l}),s.value.style.position=o,s.value.appendChild(t)},m=(e={})=>{t&&(d&&(t.style.background=`url(${g()}) left top repeat`),e.width&&(t.style.width=`${e.width}px`),e.height&&(t.style.height=`${e.height}px`))},g=()=>{const{color:e,opacity:a,size:o,family:i,angle:l,width:x,height:p}=v,c=document.createElement("canvas");c.width=x,c.height=p;const n=c.getContext("2d");return n&&(n.fillStyle=e,n.globalAlpha=a,n.font=`${o}px ${i}`,n.rotate(Math.PI/180*l),n.fillText(d,0,p/2)),c.toDataURL()},b=()=>{if(!(!s.value||!t)){w();try{s.value.removeChild(t)}catch{console.warn(E("Please_recreate_it_watermark"))}finally{t=null}}},y=u(()=>{b(),h(),f(s.value)},100),f=e=>{v.defense?!r.watermarkElMutationObserver&&!r.parentElMutationObserver&&M(e):w("mutation"),r.parentElResizeObserver||z(e)},w=(e="all")=>{(e==="mutation"||e==="all")&&(r.watermarkElMutationObserver?.disconnect(),r.watermarkElMutationObserver=void 0,r.parentElMutationObserver?.disconnect(),r.parentElMutationObserver=void 0),(e==="resize"||e==="all")&&(r.parentElResizeObserver?.disconnect(),r.parentElResizeObserver=void 0)},M=e=>{const a=u(o=>{o.forEach(u(i=>{switch(i.type){case"attributes":i.target===t&&y();break;case"childList":i.removedNodes.forEach(l=>{l===t&&e.appendChild(t)});break}},100))},100);r.watermarkElMutationObserver=new MutationObserver(a),r.parentElMutationObserver=new MutationObserver(a),r.watermarkElMutationObserver.observe(t,{attributes:!0,childList:!1,subtree:!1}),r.parentElMutationObserver.observe(e,{attributes:!1,childList:!0,subtree:!1})},z=e=>{const a=u(()=>{const{clientWidth:o,clientHeight:i}=e;m({width:o,height:i})},500);r.parentElResizeObserver=new ResizeObserver(a),r.parentElResizeObserver.observe(e)};return R(()=>{b()}),{setWatermark:k,clearWatermark:b}}export{B as u};
